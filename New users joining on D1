drop table if exists new_users ;
create temp table new_users as
SELECT
    DISTINCT dw_users.user_id  AS "user_id",
    (DATE(coalesce(dw_users.guest_joined_at, dw_users.joined_at) )) AS "joined_date"
FROM analytics.dw_users  AS dw_users
WHERE (( dw_users.home_domain  ) ILIKE  'us')
AND ((( coalesce(dw_users.guest_joined_at, dw_users.joined_at)  ) >= ((TIMESTAMP '2024-04-01')) AND ( coalesce(dw_users.guest_joined_at, dw_users.joined_at)  ) < ((DATEADD(day,1, TIMESTAMP '2024-04-01' )))))
AND (NOT (coalesce(dw_users.user_status = 'restricted', FALSE) ) OR (coalesce(dw_users.user_status = 'restricted', FALSE) ) IS NULL)
AND (( CASE
WHEN (coalesce(dw_users.guest_reg_app,dw_users.reg_app)) in ('iphone','ipad')  THEN 'iOS'
WHEN (coalesce(dw_users.guest_reg_app,dw_users.reg_app)) = 'android'  THEN 'Android'
WHEN (coalesce(dw_users.guest_reg_app,dw_users.reg_app)) = 'web'  THEN 'Web'
ELSE 'Other'
END ) ILIKE  'iOS') AND ((dw_users.is_valid_user is true))
GROUP BY
    1,2
ORDER BY
    2 DESC
;
